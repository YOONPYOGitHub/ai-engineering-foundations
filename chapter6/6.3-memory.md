# 6.3 Memory

## ê°œìš”

**Memory**ëŠ” AI ëª¨ë¸ì´ ì •ë³´ë¥¼ ìœ ì§€í•˜ê³  í™œìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. RAGì™€ Agent ê°™ì€ ì •ë³´ ì§‘ì•½ì  ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¹íˆ ì¤‘ìš”í•˜ë©°, ì„¸ì…˜ ë‚´/ê°„ ì •ë³´ ê´€ë¦¬ë¥¼ í†µí•´ ëª¨ë¸ì˜ íš¨ìš©ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

## Memory ìœ í˜•

AI ëª¨ë¸ì€ ì„¸ ê°€ì§€ ì£¼ìš” ë©”ëª¨ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì„ ê°€ì§‘ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Long-term Memory                             â”‚
â”‚    (External Storage: DB, Vector Store, Files)                 â”‚
â”‚    - ì˜êµ¬ ì €ì¥, ìš©ëŸ‰ ë¬´ì œí•œ                                      â”‚
â”‚    - ì ‘ê·¼ ì‹œ ê²€ìƒ‰ í•„ìš”                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Retrieval
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Short-term Memory                            â”‚
â”‚    (Context Window)                                             â”‚
â”‚    - í˜„ì¬ ëŒ€í™”/ì‘ì—…ì— ì‚¬ìš©                                       â”‚
â”‚    - ìš©ëŸ‰ ì œí•œ (Max Context Length)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Inference
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Internal Knowledge                           â”‚
â”‚    (Model Weights)                                              â”‚
â”‚    - í•™ìŠµ ë°ì´í„°ì—ì„œ ìŠµë“                                        â”‚
â”‚    - ë³€ê²½í•˜ë ¤ë©´ ì¬í•™ìŠµ/íŒŒì¸íŠœë‹ í•„ìš”                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„¸ ê°€ì§€ Memory ë¹„êµ

| íŠ¹ì„± | Internal Knowledge | Short-term Memory | Long-term Memory |
|------|-------------------|-------------------|------------------|
| **ì €ì¥ ìœ„ì¹˜** | ëª¨ë¸ ê°€ì¤‘ì¹˜ | Context Window | ì™¸ë¶€ ì €ì¥ì†Œ |
| **ì§€ì†ì„±** | ì˜êµ¬ (ëª¨ë¸ ë³€ê²½ ì „ê¹Œì§€) | ì„¸ì…˜ ë‚´ | ì˜êµ¬ (ì‚­ì œ ì „ê¹Œì§€) |
| **ìš©ëŸ‰** | ëª¨ë¸ í¬ê¸°ì— ë¹„ë¡€ | Context í•œê³„ | ì‚¬ì‹¤ìƒ ë¬´ì œí•œ |
| **ì ‘ê·¼ ì†ë„** | ì¦‰ì‹œ | ì¦‰ì‹œ | ê²€ìƒ‰ í•„ìš” |
| **ì—…ë°ì´íŠ¸** | ì¬í•™ìŠµ/íŒŒì¸íŠœë‹ | ë™ì  ì¶”ê°€ | ë™ì  ì¶”ê°€/ì‚­ì œ |
| **ì˜ˆì‹œ** | ì–¸ì–´ ê·œì¹™, ìƒì‹ | í˜„ì¬ ëŒ€í™” ë‚´ìš© | ê³¼ê±° ëŒ€í™”, ë¬¸ì„œ |

### ì¸ê°„ Memoryì™€ì˜ ë¹„ìœ 

| AI Memory | ì¸ê°„ Memory | ì˜ˆì‹œ |
|-----------|-------------|------|
| Internal Knowledge | ì ˆì°¨ì  ê¸°ì–µ | ìˆ¨ì‰¬ê¸°, ê±·ê¸° |
| Short-term Memory | ì‘ì—… ê¸°ì–µ | ë°©ê¸ˆ ë“¤ì€ ì „í™”ë²ˆí˜¸ |
| Long-term Memory | ì™¸ë¶€ ë„êµ¬ | ì±…, ì»´í“¨í„°, ë©”ëª¨ |

---

## Memoryì˜ ì¤‘ìš”ì„±

### 1. ì„¸ì…˜ ë‚´ ì •ë³´ ì˜¤ë²„í”Œë¡œìš° ê´€ë¦¬

Agentê°€ ì‘ì—… ìˆ˜í–‰ ì¤‘ íšë“í•˜ëŠ” ì •ë³´ê°€ Context í•œê³„ë¥¼ ì´ˆê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
Agent ì‘ì—… ì¤‘:
â”œâ”€ ê³„íš ìƒì„± (1,000 í† í°)
â”œâ”€ Tool í˜¸ì¶œ 1 ê²°ê³¼ (2,000 í† í°)
â”œâ”€ Tool í˜¸ì¶œ 2 ê²°ê³¼ (3,000 í† í°)
â”œâ”€ Reflection (500 í† í°)
â”œâ”€ Tool í˜¸ì¶œ 3 ê²°ê³¼ (5,000 í† í°)
â”œâ”€ ...
â””â”€ Context í•œê³„ ë„ë‹¬! ğŸš«
```

**í•´ê²°:** ì˜¤ë˜ëœ/ëœ ì¤‘ìš”í•œ ì •ë³´ë¥¼ Long-term Memoryë¡œ ì´ë™

### 2. ì„¸ì…˜ ê°„ ì •ë³´ ì§€ì†

```
ì„¸ì…˜ 1: "ì €ëŠ” ì±„ì‹ì£¼ì˜ìì…ë‹ˆë‹¤"
        â†“ (ì €ì¥)
ì„¸ì…˜ 2: "ì €ë… ë©”ë‰´ ì¶”ì²œí•´ì¤˜"
        â†‘ (ê²€ìƒ‰)
        â†’ "ì±„ì‹ ì˜µì…˜ì¸ ë‘ë¶€ ìŠ¤í…Œì´í¬ëŠ” ì–´ë– ì„¸ìš”?"
```

**í™œìš©:**
- ì‚¬ìš©ì ì„ í˜¸ë„ ê¸°ì–µ
- ì´ì „ ëŒ€í™” ë§¥ë½ ìœ ì§€
- ê°œì¸í™”ëœ ê²½í—˜ ì œê³µ

### 3. ì¼ê´€ì„± í–¥ìƒ

ì´ì „ ë‹µë³€ì„ ì°¸ì¡°í•˜ì—¬ ì¼ê´€ëœ ì‘ë‹µ ìƒì„±

```
ì§ˆë¬¸ 1: "ì´ ë†ë‹´ 1-5ì ìœ¼ë¡œ í‰ê°€í•´ì¤˜" â†’ "3ì ì…ë‹ˆë‹¤"
        â†“ (ì €ì¥)
ì§ˆë¬¸ 2: "ê°™ì€ ë†ë‹´ ë‹¤ì‹œ í‰ê°€í•´ì¤˜"
        â†‘ (ì°¸ì¡°)
        â†’ "ì´ì „ê³¼ ë™ì¼í•˜ê²Œ 3ì ì…ë‹ˆë‹¤"
```

### 4. ë°ì´í„° êµ¬ì¡° ìœ ì§€

í…ìŠ¤íŠ¸ ê¸°ë°˜ Contextì˜ ë¹„êµ¬ì¡°í™” ë¬¸ì œ í•´ê²°

```
Context (ë¹„êµ¬ì¡°í™”):
"ì´ë¦„: í™ê¸¸ë™, ë‚˜ì´: 30, ì§ì—…: ê°œë°œì, ì´ë¦„: ê¹€ì² ìˆ˜, ë‚˜ì´: 25..."

Memory System (êµ¬ì¡°í™”):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í…Œì´ë¸”: users                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ë¦„     â”‚ ë‚˜ì´   â”‚ ì§ì—…          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í™ê¸¸ë™   â”‚ 30     â”‚ ê°œë°œì        â”‚
â”‚ ê¹€ì² ìˆ˜   â”‚ 25     â”‚ ë””ìì´ë„ˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory ê´€ë¦¬

Memory ì‹œìŠ¤í…œì€ ë‘ ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

### 1. Memory Retrieval (ê²€ìƒ‰)

RAG ê²€ìƒ‰ê³¼ ìœ ì‚¬í•˜ê²Œ Long-term Memoryì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.

```python
def retrieve_memories(query, top_k=5):
    # ê´€ë ¨ ê¸°ì–µ ê²€ìƒ‰
    relevant_memories = vector_search(
        query_embedding=embed(query),
        database=long_term_memory,
        top_k=top_k
    )
    return relevant_memories
```

### 2. Memory Management (ê´€ë¦¬)

#### Add Memory (ì¶”ê°€)

```python
def add_memory(content, metadata=None):
    # ìƒˆ ì •ë³´ë¥¼ Long-term Memoryì— ì €ì¥
    memory_entry = {
        "content": content,
        "embedding": embed(content),
        "timestamp": now(),
        "metadata": metadata
    }
    long_term_memory.insert(memory_entry)
```

#### Delete Memory (ì‚­ì œ)

```python
def delete_memory(criteria):
    # ì¡°ê±´ì— ë§ëŠ” ê¸°ì–µ ì‚­ì œ
    # (ì˜¤ë˜ëœ ì •ë³´, ì¤‘ë³µ, ì˜ëª»ëœ ì •ë³´ ë“±)
    long_term_memory.delete(criteria)
```

---

## Short-term Memory ê´€ë¦¬ ì „ëµ

Context í•œê³„ë¡œ ì¸í•´ Short-term MemoryëŠ” ì ê·¹ì ì¸ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### 1. FIFO (First In, First Out)

ê°€ì¥ ì˜¤ë˜ëœ ì •ë³´ë¶€í„° ì œê±°í•©ë‹ˆë‹¤.

```
Short-term Memory (ìµœëŒ€ 5ê°œ):
[M1, M2, M3, M4, M5]
      â†“ ìƒˆ ë©”ì‹œì§€ M6 ì¶”ê°€
[M2, M3, M4, M5, M6]  # M1 ì œê±° (Long-termìœ¼ë¡œ ì´ë™)
```

**ì¥ì :**
- êµ¬í˜„ ê°„ë‹¨
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë™ì‘

**ë‹¨ì :**
- ì´ˆê¸° ì¤‘ìš” ì •ë³´ ì†ì‹¤ ê°€ëŠ¥
- ëŒ€í™” ëª©ì ì´ ì²« ë©”ì‹œì§€ì— ìˆì„ ê²½ìš° ë¬¸ì œ

### 2. ìµœê·¼ Nê°œ ìœ ì§€

ë§ˆì§€ë§‰ Nê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€í•©ë‹ˆë‹¤.

```python
def manage_short_term(messages, max_messages=10):
    if len(messages) > max_messages:
        # ì´ˆê³¼ë¶„ì€ Long-termìœ¼ë¡œ ì´ë™
        overflow = messages[:-max_messages]
        save_to_long_term(overflow)
        return messages[-max_messages:]
    return messages
```

### 3. Token ê¸°ë°˜ ê´€ë¦¬

í† í° ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```python
def manage_by_tokens(messages, max_tokens=4000):
    total_tokens = 0
    kept_messages = []
    
    # ìµœì‹  ë©”ì‹œì§€ë¶€í„° ì—­ìˆœìœ¼ë¡œ ì¶”ê°€
    for msg in reversed(messages):
        msg_tokens = count_tokens(msg)
        if total_tokens + msg_tokens <= max_tokens:
            kept_messages.insert(0, msg)
            total_tokens += msg_tokens
        else:
            save_to_long_term(msg)
    
    return kept_messages
```

---

## ê³ ê¸‰ Memory ê´€ë¦¬ ì „ëµ

### 1. Summarization (ìš”ì•½)

ëŒ€í™”ë¥¼ ìš”ì•½í•˜ì—¬ ì••ì¶•í•©ë‹ˆë‹¤.

```
ì›ë³¸ ëŒ€í™” (2,000 í† í°):
â”œâ”€ User: "ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ Python í”„ë¡œì íŠ¸ ê´€ë ¨ ì§ˆë¬¸ì´ ìˆì–´ìš”..."
â”œâ”€ Assistant: "ë„¤, ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
â”œâ”€ User: "Flaskë¡œ REST APIë¥¼ ë§Œë“¤ë ¤ê³  í•˜ëŠ”ë°..."
â”œâ”€ ... (ê¸´ ëŒ€í™”)
â””â”€ Assistant: "ë„¤, ê·¸ë ‡ê²Œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤."

ìš”ì•½ (200 í† í°):
"ì‚¬ìš©ìê°€ Flask REST API ê°œë°œ ì¤‘ì´ë©°, 
 ì¸ì¦ êµ¬í˜„ê³¼ ì—ëŸ¬ í•¸ë“¤ë§ì— ëŒ€í•´ ë…¼ì˜í•¨.
 JWT í† í° ë°©ì‹ê³¼ ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì‚¬ìš©ì„ ê¶Œì¥í•¨."
```

```python
def summarize_conversation(messages):
    summary = llm.generate(
        prompt=f"ë‹¤ìŒ ëŒ€í™”ë¥¼ ê°„ê²°í•˜ê²Œ ìš”ì•½í•˜ì„¸ìš”:\n{messages}"
    )
    return summary
```

### 2. Named Entity Tracking

ì¤‘ìš” ì—”í‹°í‹°ë¥¼ ë³„ë„ë¡œ ì¶”ì í•©ë‹ˆë‹¤.

```python
entities = {
    "user_name": "í™ê¸¸ë™",
    "project": "Flask REST API",
    "tech_stack": ["Python", "Flask", "JWT"],
    "current_issue": "ì¸ì¦ êµ¬í˜„",
    "preferences": {
        "language": "Korean",
        "code_style": "PEP 8"
    }
}
```

### 3. Selective Memory (ì„ íƒì  ì €ì¥)

ì¤‘ìš”í•œ ì •ë³´ë§Œ ì„ ë³„í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.

**Bae et al. (2022) ì ‘ê·¼ë²•:**

```
ëŒ€í™” ìš”ì•½ ìƒì„±
     â†“
ìš”ì•½ì—ì„œ ëˆ„ë½ëœ í•µì‹¬ ì •ë³´ ì‹ë³„
     â†“
ìš”ì•½ + í•µì‹¬ ì •ë³´ = ìƒˆ Memory
```

```python
def selective_memory(conversation, summary):
    new_memory = []
    
    for sentence in conversation:
        for summary_sentence in summary:
            relevance = classifier(sentence, summary_sentence)
            
            if relevance == "only_original":
                # ìš”ì•½ì— ì—†ëŠ” ì¤‘ìš” ì •ë³´ â†’ ì¶”ê°€
                new_memory.append(sentence)
            elif relevance == "both":
                # ìš”ì•½ì— ìˆìŒ â†’ ìš”ì•½ ìœ ì§€
                pass
            elif relevance == "neither":
                # ë‘˜ ë‹¤ ë¶ˆí•„ìš” â†’ ì œê±°
                pass
    
    return summary + new_memory
```

### 4. Reflection-based Memory (Liu et al., 2023)

ê° ì •ë³´ì— ëŒ€í•´ ë°˜ì„±ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

```python
def reflection_memory_update(new_info, existing_memory):
    decision = llm.generate(
        prompt=f"""
        ìƒˆ ì •ë³´: {new_info}
        ê¸°ì¡´ ë©”ëª¨ë¦¬: {existing_memory}
        
        ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:
        1. INSERT: ìƒˆ ì •ë³´ë¥¼ ë©”ëª¨ë¦¬ì— ì¶”ê°€
        2. MERGE: ê¸°ì¡´ ì •ë³´ì™€ ë³‘í•©
        3. REPLACE: ê¸°ì¡´ ì •ë³´ë¥¼ ìƒˆ ì •ë³´ë¡œ êµì²´ (ëª¨ìˆœë˜ê±°ë‚˜ ì˜¤ë˜ëœ ê²½ìš°)
        4. IGNORE: ìƒˆ ì •ë³´ ë¬´ì‹œ
        """
    )
    return apply_decision(decision, new_info, existing_memory)
```

---

## Memory í• ë‹¹ ì „ëµ

Short-termê³¼ Long-term Memory ê°„ Context ê³µê°„ ë¶„ë°°

```
Total Context = 8,000 tokens

ë¶„ë°° ì˜ˆì‹œ:
â”œâ”€ System Prompt: 500 tokens (ê³ ì •)
â”œâ”€ Retrieved from Long-term: 2,400 tokens (30%)
â”œâ”€ Short-term Memory: 4,600 tokens (57.5%)
â””â”€ Generation Buffer: 500 tokens

ì„ê³„ê°’ ê´€ë¦¬:
if short_term_tokens > 4,600:
    overflow = short_term_tokens - 4,600
    move_to_long_term(overflow)
```

---

## ëª¨ìˆœ ì²˜ë¦¬ (Contradiction Handling)

ìƒˆ ì •ë³´ê°€ ê¸°ì¡´ ì •ë³´ì™€ ëª¨ìˆœë  ë•Œì˜ ì²˜ë¦¬ ì „ëµ

| ì „ëµ | ì„¤ëª… | ì¥ì  | ë‹¨ì  |
|------|------|------|------|
| **ìµœì‹  ìš°ì„ ** | ìƒˆ ì •ë³´ë¡œ ëŒ€ì²´ | ê°„ë‹¨, ìµœì‹  ìƒíƒœ ìœ ì§€ | ì˜¤ë˜ëœ ì •ë³´ê°€ ë§ì„ ìˆ˜ë„ |
| **AI íŒë‹¨** | ëª¨ë¸ì´ ì–´ë–¤ ê²ƒì„ ìœ ì§€í• ì§€ ê²°ì • | ë¬¸ë§¥ ê³ ë ¤ ê°€ëŠ¥ | ì¶”ê°€ ë¹„ìš©, ì˜¤ë¥˜ ê°€ëŠ¥ |
| **ë‘˜ ë‹¤ ìœ ì§€** | ëª¨ìˆœë˜ëŠ” ì •ë³´ ëª¨ë‘ ì €ì¥ | ë‹¤ì–‘í•œ ê´€ì  | í˜¼ë€ ì•¼ê¸° ê°€ëŠ¥ |
| **ì‚¬ëŒ í™•ì¸** | ëª¨ìˆœ ë°œê²¬ ì‹œ ì‚¬ìš©ìì—ê²Œ ì§ˆë¬¸ | ì •í™•ë„ ë†’ìŒ | UX ì €í•˜ |

```python
def handle_contradiction(new_info, existing_info):
    if is_contradicting(new_info, existing_info):
        # ì˜µì…˜ 1: ìµœì‹  ìš°ì„ 
        # return new_info
        
        # ì˜µì…˜ 2: AI íŒë‹¨
        decision = llm.generate(
            f"ë‹¤ìŒ ì¤‘ ë” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ëŠ”?\n"
            f"ê¸°ì¡´: {existing_info}\nìƒˆë¡œìš´: {new_info}"
        )
        return decision
```

---

## Memory ì‹œìŠ¤í…œ êµ¬í˜„ ì˜ˆì‹œ

```python
class MemorySystem:
    def __init__(self, max_short_term_tokens=4000):
        self.short_term = []  # í˜„ì¬ ì„¸ì…˜ ë©”ì‹œì§€
        self.long_term = VectorStore()  # ì˜êµ¬ ì €ì¥ì†Œ
        self.entities = {}  # ì—”í‹°í‹° ì¶”ì 
        self.max_tokens = max_short_term_tokens
    
    def add_message(self, message):
        """ìƒˆ ë©”ì‹œì§€ ì¶”ê°€ ë° ë©”ëª¨ë¦¬ ê´€ë¦¬"""
        self.short_term.append(message)
        self._extract_entities(message)
        self._manage_overflow()
    
    def _manage_overflow(self):
        """Short-term ì˜¤ë²„í”Œë¡œìš° ì²˜ë¦¬"""
        while self._count_tokens() > self.max_tokens:
            # FIFO: ê°€ì¥ ì˜¤ë˜ëœ ë©”ì‹œì§€ë¥¼ Long-termìœ¼ë¡œ ì´ë™
            old_message = self.short_term.pop(0)
            self.long_term.add(old_message)
    
    def retrieve_context(self, query):
        """í˜„ì¬ ì¿¼ë¦¬ì— ê´€ë ¨ëœ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±"""
        # Short-term Memory
        short_term_context = self.short_term
        
        # Long-term Memoryì—ì„œ ê´€ë ¨ ì •ë³´ ê²€ìƒ‰
        long_term_context = self.long_term.search(query, top_k=5)
        
        # ì—”í‹°í‹° ì •ë³´ ì¶”ê°€
        entity_context = self._format_entities()
        
        return {
            "short_term": short_term_context,
            "long_term": long_term_context,
            "entities": entity_context
        }
    
    def get_summary(self):
        """ì „ì²´ ëŒ€í™” ìš”ì•½"""
        return summarize(self.short_term)
```

---

## Memory ê´€ë¦¬ ë„êµ¬ ë° ì„œë¹„ìŠ¤

| ë„êµ¬/ì„œë¹„ìŠ¤ | íŠ¹ì§• |
|------------|------|
| **LangChain Memory** | ë‹¤ì–‘í•œ Memory íƒ€ì… ì§€ì› (Buffer, Summary, Entity ë“±) |
| **Mem0** | ì˜êµ¬ì  Memory ê´€ë¦¬ ì„œë¹„ìŠ¤ |
| **Zep** | ì¥ê¸° ëŒ€í™” Memory íŠ¹í™” |
| **MotÃ¶rhead** | ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ê´€ë¦¬ ì„œë²„ |
| **Redis** | ë¹ ë¥¸ ì„¸ì…˜ ì €ì¥ì†Œ |
| **PostgreSQL + pgvector** | êµ¬ì¡°í™” + ë²¡í„° ì €ì¥ì†Œ ê²°í•© |

---

## í† ë¡  ì§ˆë¬¸

1. **FIFOì˜ í•œê³„**: ì²« ë©”ì‹œì§€ì— ì¤‘ìš” ì •ë³´ê°€ ìˆì„ ë•Œ ì–´ë–»ê²Œ ë³´ì¡´í•  ê²ƒì¸ê°€?
2. **ìš”ì•½ í’ˆì§ˆ**: ìë™ ìš”ì•½ ì‹œ ì¤‘ìš” ì •ë³´ ì†ì‹¤ì„ ì–´ë–»ê²Œ ìµœì†Œí™”í•  ê²ƒì¸ê°€?
3. **ëª¨ìˆœ ì²˜ë¦¬**: ì‚¬ìš©ìê°€ ì´ì „ì— ë§í•œ ê²ƒê³¼ ë‹¤ë¥¸ ì •ë³´ë¥¼ ì œê³µí•  ë•Œ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?
4. **ê°œì¸ì •ë³´**: Memoryì— ì €ì¥ëœ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ë³´í˜¸í•  ê²ƒì¸ê°€?
5. **Multi-user**: ì—¬ëŸ¬ ì‚¬ìš©ì ê°„ Memoryë¥¼ ì–´ë–»ê²Œ ê²©ë¦¬í•˜ê³  ê´€ë¦¬í•  ê²ƒì¸ê°€?
